---

# **Modding API для MyCraft III (Обновленная версия)**

Modding API для **MyCraft III** позволяет разработчикам модификаций расширять функциональность игры с помощью Lua-скриптов. В этом документе описаны все доступные функции и события, которые вы можете использовать в своих модах.

## **Начало работы**

Чтобы создать мод для **MyCraft III**, вам нужно создать Lua-скрипт с определенными функциями и использовать предоставленные API-функции для взаимодействия с игрой.

---

## **Содержание**

1. [Глобальные функции](#Глобальные-функции)
   - [setBlk(x, y, z, blockID)](#setBlk)
   - [removeBlk(x, y, z)](#removeBlk)
   - [spwnEntity(x, y, z, ai)](#spwnEntity)
   - [playSound(sound_path)](#playSound)
   - [createUi(ui_type, position, scale, params)](#createUi)
   - [addBlock(texture_path, sound_path)](#addBlock)
   - [getPlayerX()](#getPlayerX)
   - [getPlayerY()](#getPlayerY)
   - [getPlayerZ()](#getPlayerZ)
   - [setPlayerX(x)](#setPlayerX)
   - [setPlayerY(y)](#setPlayerY)
   - [setPlayerZ(z)](#setPlayerZ)
   - [getBlockAt(x, y, z)](#getBlockAt)
   - [typeToID(block_type)](#typeToID)
   - [addMusic(music_path)](#addMusic)
   - [getCfgKey(key)](#getCfgKey)
   - [setCfgKey(key, value)](#setCfgKey)
   - [getWorldList()](#getWorldList)
   - [getPlayerSpeed()](#getPlayerSpeed)
   - [setPlayerSpeed(speed)](#setPlayerSpeed)
   - [setPlayerAirTime(value)](#setPlayerAirTime)
2. [События](#События)
   - [function onStart()](#onStart)
   - [function onUpdate()](#onUpdate)
   - [function onKey(key)](#onKey)
   - [function onPlaceBlk(x, y, z)](#onPlaceBlk)
   - [function onBreakBlk(x, y, z)](#onBreakBlk)
3. [Примеры использования](#Примеры-использования)
4. [Замечания](#Замечания)
5. [Заключение](#Заключение)

---

## **Глобальные функции**

### <a name="setBlk"></a>**setBlk(x, y, z, blockID)**

**Описание:**
Устанавливает блок указанного типа по заданным координатам.

**Параметры:**
- `x` (`number`): координата X.
- `y` (`number`): координата Y.
- `z` (`number`): координата Z.
- `blockID` (`number`): идентификатор типа блока.

**Пример:**
```lua
setBlk(10, 64, 10, 2) -- Установит блок с ID 2 по координатам (10, 64, 10)
```

---

### <a name="removeBlk"></a>**removeBlk(x, y, z)**

**Описание:**
Удаляет блок по заданным координатам.

**Параметры:**
- `x` (`number`): координата X.
- `y` (`number`): координата Y.
- `z` (`number`): координата Z.

**Пример:**
```lua
removeBlk(10, 64, 10) -- Удалит блок по координатам (10, 64, 10)
```

---

### <a name="spwnEntity"></a>**spwnEntity(x, y, z, ai)**

**Описание:**
Создает сущность (например, моба или NPC) по заданным координатам.

**Параметры:**
- `x` (`number`): координата X.
- `y` (`number`): координата Y.
- `z` (`number`): координата Z.
- `ai` (`boolean`): `true` - включить искусственный интеллект, `false` - выключить (существо будет стоять на месте).

**Пример:**
```lua
spwnEntity(15, 65, 15, true) -- Создаст сущность по координатам (15, 65, 15) с включенным ИИ
```

---

### <a name="playSound"></a>**playSound(sound_path)**

**Описание:**
Воспроизводит звук из указанного файла.

**Параметры:**
- `sound_path` (`string`): путь к звуковому файлу.

**Пример:**
```lua
playSound('res/sounds/explosion.wav') -- Воспроизведет звук взрыва
```

---

### <a name="createUi"></a>**createUi(ui_type, position, scale, params)**

**Описание:**
Создает элемент пользовательского интерфейса (UI) указанного типа.

**Параметры:**
- `ui_type` (`number`): тип элемента UI.
  - `1` – текстурированная кнопка (`texture_button`).
  - `2` – текст (`create_text`).
  - `3` – изображение (`add_image`).
- `position` (`table`): позиция элемента UI с ключами `x`, `y`.
- `scale` (`table`): масштаб элемента UI с ключами `x`, `y`.
- `params` (`table`): дополнительные параметры, зависящие от типа элемента.

**Пример:**
```lua
-- Создать кнопку с текстурой и назначить ей функцию onButtonClick
createUi(1, {x=0, y=0}, {x=0.2, y=0.1}, {texture='res/ui/button.png', on_click='onButtonClick'})
```

---

### <a name="addBlock"></a>**addBlock(texture_path, sound_path)**

**Описание:**
Добавляет новый тип блока в игру.

**Параметры:**
- `texture_path` (`string`): путь к текстуре блока.
  - **Примечание:** Если текстура находится вне папки `res`, добавьте в начале `../`, чтобы указать путь относительно корневой директории.
- `sound_path` (`string`): путь к звуку разрушения блока.

**Возвращаемое значение:**
- `number`: идентификатор нового блока.

**Пример:**
```lua
local blockID = addBlock('textures/my_custom_block', 'res/sounds/stone1.ogg') -- Добавит новый блок и вернет его ID
```

---

### <a name="getPlayerX"></a>**getPlayerX()**

**Описание:**
Возвращает текущую координату X игрока.

**Возвращаемое значение:**
- `number`: координата X игрока.

**Пример:**
```lua
local playerX = getPlayerX()
print("Позиция игрока X:", playerX)
```

---

### <a name="getPlayerY"></a>**getPlayerY()**

**Описание:**
Возвращает текущую координату Y игрока.

**Возвращаемое значение:**
- `number`: координата Y игрока.

**Пример:**
```lua
local playerY = getPlayerY()
print("Позиция игрока Y:", playerY)
```

---

### <a name="getPlayerZ"></a>**getPlayerZ()**

**Описание:**
Возвращает текущую координату Z игрока.

**Возвращаемое значение:**
- `number`: координата Z игрока.

**Пример:**
```lua
local playerZ = getPlayerZ()
print("Позиция игрока Z:", playerZ)
```

---

### <a name="setPlayerX"></a>**setPlayerX(x)**

**Описание:**
Устанавливает координату X игрока.

**Параметры:**
- `x` (`number`): новая координата X игрока.

**Пример:**
```lua
setPlayerX(100) -- Переместит игрока на координату X = 100
```

---

### <a name="setPlayerY"></a>**setPlayerY(y)**

**Описание:**
Устанавливает координату Y игрока.

**Параметры:**
- `y` (`number`): новая координата Y игрока.

**Пример:**
```lua
setPlayerY(70) -- Переместит игрока на координату Y = 70
```

---

### <a name="setPlayerZ"></a>**setPlayerZ(z)**

**Описание:**
Устанавливает координату Z игрока.

**Параметры:**
- `z` (`number`): новая координата Z игрока.

**Пример:**
```lua
setPlayerZ(200) -- Переместит игрока на координату Z = 200
```

---

### <a name="getBlockAt"></a>**getBlockAt(x, y, z)**

**Описание:**
Возвращает тип блока по указанным координатам.

**Параметры:**
- `x` (`number`): координата X.
- `y` (`number`): координата Y.
- `z` (`number`): координата Z.

**Возвращаемое значение:**
- `string`: тип блока (например, `'grass'`, `'stone'`) или `'air'`, если блока нет.

**Пример:**
```lua
local blockType = getBlockAt(10, 64, 10)
print("Тип блока:", blockType)
```

---

### <a name="typeToID"></a>**typeToID(block_type)**

**Описание:**
Возвращает идентификатор блока по его типу.

**Параметры:**
- `block_type` (`string`): тип блока (например, `'grass'`, `'stone'`).

**Возвращаемое значение:**
- `number`: идентификатор блока или `-1`, если тип не найден.

**Пример:**
```lua
local blockID = typeToID('stone')
print("ID блока 'stone':", blockID)
```

---

### <a name="addMusic"></a>**addMusic(music_path)**

**Описание:**
Добавляет музыкальный файл в список случайного воспроизведения.

**Параметры:**
- `music_path` (`string`): путь к музыкальному файлу.

**Пример:**
```lua
addMusic('res/music/my_custom_track.ogg') -- Добавит трек в список музыки
```

---

### <a name="getCfgKey"></a>**getCfgKey(key)**

**Описание:**
Получает значение указанного ключа из файла конфигурации `config.cfg`.

**Параметры:**
- `key` (`string`): имя ключа.

**Возвращаемое значение:**
- `string`: значение ключа.

**Пример:**
```lua
local renderDistance = getCfgKey('render-distance')
print("Render Distance:", renderDistance)
```

---

### <a name="setCfgKey"></a>**setCfgKey(key, value)**

**Описание:**
Устанавливает значение указанного ключа в файле конфигурации `config.cfg`.

**Параметры:**
- `key` (`string`): имя ключа.
- `value` (`string`): новое значение ключа.

**Пример:**
```lua
setCfgKey('render-distance', '5') -- Устанавливает render-distance на 5
```

---

### <a name="getWorldList"></a>**getWorldList()**

**Описание:**
Возвращает список миров (например, список загруженных чанков).

**Возвращаемое значение:**
- `table`: список миров.

**Пример:**
```lua
local worlds = getWorldList()
for i, world in ipairs(worlds) do
    print("Мир " .. i .. ": " .. tostring(world))
end
```

---

### <a name="getPlayerSpeed"></a>**getPlayerSpeed()**

**Описание:**
Возвращает текущую скорость игрока.

**Возвращаемое значение:**
- `number`: скорость игрока.

**Пример:**
```lua
local speed = getPlayerSpeed()
print("Скорость игрока:", speed)
```

---

### <a name="setPlayerSpeed"></a>**setPlayerSpeed(speed)**

**Описание:**
Устанавливает скорость игрока.

**Параметры:**
- `speed` (`number`): новая скорость игрока.

**Пример:**
```lua
setPlayerSpeed(10) -- Устанавливает скорость игрока на 10
```

---

### <a name="setPlayerAirTime"></a>**setPlayerAirTime(value)**

**Описание:**
Устанавливает значение `air_time` для игрока, которое влияет на скорость падения и гравитацию.

**Параметры:**
- `value` (`number`): новое значение `air_time`.

**Пример:**
```lua
setPlayerAirTime(0) -- Сбрасывает air_time игрока
```

---

## **События**

### <a name="onStart"></a>**function onStart()**

**Описание:**
Функция, которая вызывается при запуске мода. Здесь можно разместить код инициализации.

**Пример:**
```lua
function onStart()
    print("Мой мод запущен!")
    -- Дополнительный код инициализации
end
```

---

### <a name="onUpdate"></a>**function onUpdate()**

**Описание:**
Функция, которая вызывается каждый кадр. Здесь можно разместить код, который должен выполняться постоянно.

**Пример:**
```lua
function onUpdate()
    -- Код, который выполняется каждый кадр
    local x = getPlayerX()
    if x > 100 then
        print("Вы достигли координаты X = 100!")
    end
end
```

---

### <a name="onKey"></a>**function onKey(key)**

**Описание:**
Функция, которая вызывается при нажатии клавиши.

**Параметры:**
- `key` (`string`): название нажатой клавиши.

**Пример:**
```lua
function onKey(key)
    if key == 'space' then
        print("Вы нажали пробел!")
        -- Дополнительные действия при нажатии пробела
    end
end
```

---

### <a name="onPlaceBlk"></a>**function onPlaceBlk(x, y, z)**

**Описание:**
Функция, которая вызывается при размещении блока игроком.

**Параметры:**
- `x` (`number`): координата X блока.
- `y` (`number`): координата Y блока.
- `z` (`number`): координата Z блока.

**Пример:**
```lua
function onPlaceBlk(x, y, z)
    print("Блок размещен на координатах:", x, y, z)
    -- Дополнительные действия при размещении блока
end
```

---

### <a name="onBreakBlk"></a>**function onBreakBlk(x, y, z)**

**Описание:**
Функция, которая вызывается при разрушении блока игроком.

**Параметры:**
- `x` (`number`): координата X блока.
- `y` (`number`): координата Y блока.
- `z` (`number`): координата Z блока.

**Пример:**
```lua
function onBreakBlk(x, y, z)
    print("Блок разрушен на координатах:", x, y, z)
    -- Дополнительные действия при разрушении блока
end
```

---

## **Примеры использования**

### **Пример 1: Мод "Телепортатор"**

```lua
-- teleport_mod.lua

function onStart()
    print("Мод 'Телепортатор' загружен!")
end

function onKey(key)
    if key == 't' then
        -- Телепортируем игрока в случайные координаты
        local x = math.random(1, 100)
        local y = math.random(50, 80)
        local z = math.random(1, 100)
        setPlayerX(x)
        setPlayerY(y)
        setPlayerZ(z)
        print("Вы были телепортированы в координаты:", x, y, z)
    end
end
```

**Описание:**
При нажатии клавиши 'T' игрок телепортируется в случайные координаты.

---

### **Пример 2: Мод "Быстрый бег"**

```lua
-- speed_mod.lua

function onStart()
    print("Мод 'Быстрый бег' запущен!")
    setPlayerSpeed(10) -- Увеличиваем скорость игрока
end

function onUpdate()
    -- Возвращаем скорость к нормальной при падении
    if getPlayerY() < 60 then
        setPlayerSpeed(5)
    end
end
```

**Описание:**
Увеличивает скорость игрока, пока он находится выше высоты 60.

---

### **Пример 3: Мод "Динамическая гравитация"**

```lua
-- gravity_mod.lua

function onStart()
    print("Мод 'Динамическая гравитация' активирован!")
end

function onUpdate()
    local y = getPlayerY()
    if y > 100 then
        -- В невысомости
        setPlayerAirTime(0)
        print("Вы вошли в состояние невесомости!")
    else
        -- Обычная гравитация
        setPlayerAirTime(y / 100)
    end
end
```

**Описание:**
Изменяет гравитацию игрока в зависимости от его высоты. На высоте выше 100 блоков игрок находится в невесомости.

---

### **Пример 4: Мод "Аварийная посадка"**

```lua
-- landing_mod.lua

function onBreakBlk(x, y, z)
    local playerY = getPlayerY()
    if playerY > 80 then
        print("Вы сломали блок на высоте! Аварийная посадка...")
        setPlayerY(10) -- Перемещаем игрока на нижний уровень
        playSound('res/sounds/landing.ogg')
    end
end
```

**Описание:**
Если игрок разрушает блок на большой высоте, мод телепортирует его вниз и воспроизводит звук посадки.

---

### **Пример 5: Мод "Музыкальный блок"**

```lua
-- music_block_mod.lua

function onPlaceBlk(x, y, z)
    local blockType = getBlockAt(x, y, z)
    if blockType == 'music_block' then
        playSound('res/music/tune.ogg')
        print("Музыкальный блок активирован!")
    end
end

function onStart()
    print("Мод 'Музыкальный блок' загружен!")
    -- Добавляем новый блок
    local blockID = addBlock('textures/music_block', 'res/sounds/wood1.ogg')
    print("Добавлен музыкальный блок с ID:", blockID)
end
```

**Описание:**
Добавляет в игру новый блок "Музыкальный блок". При его размещении воспроизводится мелодия.

---

## **Замечания**

- **Обработка ошибок:**
  - Убедитесь, что в ваших Lua-скриптах нет синтаксических ошибок. Ошибка в скрипте может привести к тому, что мод не загрузится.
  - Используйте `print` для вывода сообщений в консоль для отладки.

- **Пути к файлам:**
  - Все пути к файлам должны быть относительно корневой директории игры.
  - Убедитесь, что файлы (например, текстуры, звуки) существуют по указанным путям.

- **Список блоков:**
  - Стандартные типы блоков включают: `'grass'`, `'stone'`, `'wood'`, `'leaves'`, `'planks'`.
  - Вы можете добавить собственные блоки с помощью функции `addBlock`.

- **Клавиши:**
  - Названия клавиш соответствуют названиям в движке Ursina. Примеры: `'space'`, `'enter'`, `'g'`, `'left mouse down'`.
  - Полный список доступных клавиш можно найти в документации Ursina.

- **Производительность:**
  - Будьте осторожны при использовании ресурсоемких операций в функции `onUpdate`, чтобы не замедлить игру.
  - По возможности оптимизируйте ваш код.

- **Безопасность:**
  - Избегайте выполнения небезопасного кода или кода, который может повредить данные игры или системы пользователя.

- **Совместимость с сервером:**
  - Моды не работают в сетевой игре. При подключении к серверу все моды отключаются, чтобы обеспечить единообразие игрового процесса для всех игроков.
  - При разработке модов учитывайте, что они будут работать только в одиночной игре.

---

## **Заключение**

Обновленный Modding API предоставляет еще больше возможностей для взаимодействия с миром игры, игроком, сущностями и настройками. Используя эти функции и события, вы можете создавать уникальные модификации, которые обогатят игровой опыт в **MyCraft III**.

Если у вас есть вопросы или предложения по улучшению API, пожалуйста, свяжитесь с разработчиками игры.

Удачного моддинга!

---

**Примечание для моддеров:**
Всегда проверяйте совместимость ваших модов с текущей версией игры и обновляйте их при необходимости. Следите за обновлениями Modding API, чтобы воспользоваться новыми функциями и улучшениями.
